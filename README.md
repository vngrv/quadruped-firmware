# Quadruped Robot Firmware

Система управления квадропедом с обратной кинематикой, генерацией походок и множественными контроллерами.

## Возможности

- ✅ Управление 10 сервоприводами через Adafruit ServoKit
- ✅ Обратная кинематика для позиционирования ног
- ✅ Генерация плавных траекторий движения с использованием кривых Безье
- ✅ Множественные контроллеры (клавиатура, сеть, компьютерное зрение)
- ✅ Система логирования с ротацией файлов
- ✅ Конфигурация через YAML файлы
- ✅ Обработка ошибок с автоматическим восстановлением
- ✅ Валидация входных данных

## Быстрый старт

### Установка зависимостей

```bash
# Минимальные зависимости
pip install -r requirements-minimal.txt

# Или все зависимости
pip install -r requirements.txt
```

### Базовая конфигурация

Конфигурация находится в `src/config/robot_config.yaml`. Основные параметры:

```yaml
robot:
  legs:
    upper_length: 10.0  # Длина верхнего звена в см
    lower_length: 10.5  # Длина нижнего звена в см
  servos:
    channels: 16
    pulse_min: 500
    pulse_max: 2500
```

### Запуск

```bash
# С сетевым контроллером (по умолчанию)
python main.py

# С клавиатурным контроллером
python main.py --controller src.controllers.local_keyboard_controller

# С указанием уровня логирования
python main.py --log-level DEBUG

# С кастомной конфигурацией
python main.py --config src/config/robot_config.yaml
```

Или используйте Makefile:

```bash
make install          # Установить зависимости
make run              # Запустить с сетевым контроллером
make run-keyboard     # Запустить с клавиатурным контроллером
make help             # Показать все команды
```

## Структура проекта

```
firmware/
├── main.py                   # Главная точка входа
├── src/                       # Исходный код приложения
│   ├── control_quadruped.py  # Основная логика запуска
│   ├── config/               # Конфигурационные файлы
│   │   ├── robot_config.yaml # Параметры робота
│   │   ├── network_config.yaml # Сетевые настройки
│   │   └── config_loader.py # Загрузчик конфигурации
│   ├── hardware/             # Управление железом
│   │   └── servo_controller.py
│   ├── kinematics/           # Обратная кинематика
│   │   └── inverse_kinematics.py
│   ├── gaits/               # Генерация походок
│   │   ├── trajectory_generator.py
│   │   └── gait_controller.py
│   ├── robot/               # Главный контроллер
│   │   └── quadruped.py     # Основной класс квадропеда
│   ├── controllers/          # Контроллеры
│   │   ├── local_keyboard_controller.py
│   │   ├── network_receiver.py
│   │   └── network_sender_keyboard.py
│   └── utils/               # Утилиты
│       ├── logger.py        # Система логирования
│       ├── exceptions.py    # Кастомные исключения
│       ├── validators.py    # Валидация входных данных
│       ├── monitoring.py    # Мониторинг метрик
│       └── alerts.py        # Система алертов
├── tests/                    # Тесты
├── docs/                     # Документация
└── logs/                     # Логи (создается автоматически)
```

## Контроллеры

### Сетевой контроллер (по умолчанию)

Принимает команды по UDP. Формат данных: `numpy.float32` массив `[x, z, y, quit]`.

### Клавиатурный контроллер

Управление с клавиатуры:
- `W` - вперед
- `S` - назад
- `A` - влево
- `D` - вправо

**Внимание:** На Linux может потребоваться `sudo` для доступа к клавиатуре.

### Контроллер компьютерного зрения

Использует YOLO + DeepSORT для отслеживания объектов и автоматического движения.

## Конфигурация

### Параметры робота

Все параметры робота настраиваются в `src/config/robot_config.yaml`:

- `legs`: Длины звеньев ног
- `servos`: Настройки сервоприводов
- `offsets`: Смещения для калибровки
- `calibration`: Углы калибровки

### Сетевые настройки

Настройки сети в `src/config/network_config.yaml`:

- `pi_ip`: IP адрес Raspberry Pi
- `pi_port`: Порт для команд
- `socket_timeout`: Таймаут сокета

## Логирование

Логи сохраняются в `logs/quadruped.log` с автоматической ротацией:
- Максимальный размер файла: 10MB
- Количество резервных копий: 5

Уровни логирования:
- `DEBUG`: Детальная отладочная информация
- `INFO`: Общая информация о работе
- `WARNING`: Предупреждения
- `ERROR`: Ошибки

## Обработка ошибок

Система включает:
- Автоматические повторы при ошибках сервоприводов
- Валидацию входных данных
- Graceful degradation при сбоях
- Детальное логирование всех ошибок

## Разработка

### Запуск тестов

```bash
make test
```

### Проверка кода

```bash
make check    # Линтер
make format   # Форматирование
```

### Очистка

```bash
make clean
```

## Требования

- Python 3.7+
- Raspberry Pi с установленным I2C
- Adafruit ServoKit для управления сервоприводами

## Лицензия

[Укажите лицензию]

## Авторы

[Укажите авторов]

## Поддержка

Для вопросов и проблем создайте issue в репозитории.

